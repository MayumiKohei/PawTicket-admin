(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[472],{634:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>x});var l=t(5155),s=t(6766),n=t(2115),i=t(5145);let d=e=>{if(!e)return"不明";if("object"==typeof e&&e&&"year"in e&&"month"in e&&"day"in e)try{let{year:a,month:t,day:l}=e;return new Date(parseInt(a,10),parseInt(t,10)-1,parseInt(l,10)).toLocaleDateString("ja-JP")}catch(e){}if("object"==typeof e&&e&&"toDate"in e&&"function"==typeof e.toDate)try{return e.toDate().toLocaleDateString("ja-JP")}catch(e){}if("object"==typeof e&&e&&"_seconds"in e&&"number"==typeof e._seconds)try{return new Date(1e3*e._seconds).toLocaleDateString("ja-JP")}catch(e){}if("string"==typeof e)try{return new Date(e).toLocaleDateString("ja-JP")}catch(e){}return"不明"};var o=t(5671),c=t(837),r=t.n(c),p=t(1685),_=t.n(p),h=t(9592);let m=e=>{let{photoUrl:a,onClose:t}=e,i=(0,n.useCallback)(e=>{("Escape"===e.key||"Enter"===e.key||" "===e.key)&&(e.preventDefault(),t())},[t]);return a?(0,l.jsx)("div",{className:_().modalOverlay,onClick:t,onKeyDown:i,role:"button",tabIndex:0,"aria-label":"モーダルを閉じる",children:(0,l.jsxs)("div",{className:_().photoModalContent,onClick:e=>e.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"photo-modal-title",children:[(0,l.jsxs)("div",{className:_().photoModalHeader,children:[(0,l.jsx)("h3",{id:"photo-modal-title",children:"ワクチン証明書"}),(0,l.jsx)("button",{className:_().closeButton,onClick:t,"aria-label":"閉じる",children:(0,l.jsx)(o.I,{name:"close"})})]}),(0,l.jsx)("div",{className:_().photoModalBody,children:(0,l.jsx)(s.default,{src:a,alt:"ワクチン証明書",width:800,height:600,className:_().photoModalImage})})]})}):null},u=e=>{var a,t,i;let{pet:c,onClose:r,onRevertToPending:p}=e,[h,u]=(0,n.useState)(null),v=(0,n.useCallback)(e=>{("Escape"===e.key||"Enter"===e.key||" "===e.key)&&(e.preventDefault(),r())},[r]);return c?(0,l.jsxs)("div",{className:_().modalOverlay,onClick:r,onKeyDown:v,role:"button",tabIndex:0,"aria-label":"モーダルを閉じる",children:[(0,l.jsxs)("div",{className:_().modalContent,onClick:e=>e.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",children:[(0,l.jsxs)("div",{className:_().modalHeader,children:[(0,l.jsx)("h3",{id:"modal-title",children:"承認済みペット詳細"}),(0,l.jsx)("button",{className:_().closeButton,onClick:r,"aria-label":"閉じる",children:(0,l.jsx)(o.I,{name:"close"})})]}),(0,l.jsxs)("div",{className:_().modalBody,children:[(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"申請ID:"}),(0,l.jsx)("span",{className:_().detailValue,children:c.applicationId})]}),(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"ペット名:"}),(0,l.jsx)("span",{className:_().detailValue,children:c.petName})]}),(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"申請日:"}),(0,l.jsx)("span",{className:_().detailValue,children:d(c.createdAt)})]}),(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"承認日:"}),(0,l.jsx)("span",{className:_().detailValue,children:d(c.approvedAt)})]}),(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"犬種:"}),(0,l.jsx)("span",{className:_().detailValue,children:null!=(a=c.petData.petBreed)?a:"不明"})]}),(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"サイズ:"}),(0,l.jsx)("span",{className:_().detailValue,children:null!=(t=c.petData.size)?t:"不明"})]}),(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"性別:"}),(0,l.jsx)("span",{className:_().detailValue,children:null!=(i=c.petData.sex)?i:"不明"})]}),c.petData.rabiesVaccine&&(0,l.jsxs)("div",{className:_().vaccineSection,children:[(0,l.jsx)("h4",{className:_().vaccineTitle,children:"狂犬病ワクチン"}),(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"接種日:"}),(0,l.jsx)("span",{className:_().detailValue,children:c.petData.rabiesVaccine.date?d(c.petData.rabiesVaccine.date):"不明"})]}),c.petData.rabiesVaccine.certPhoto&&(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"証明書:"}),(0,l.jsx)("div",{className:_().photoContainer,children:(0,l.jsx)("button",{onClick:()=>{var e,a;return u(null!=(a=null==(e=c.petData.rabiesVaccine)?void 0:e.certPhoto)?a:null)},className:_().photoButton,"aria-label":"証明書を拡大",children:(0,l.jsx)(s.default,{src:c.petData.rabiesVaccine.certPhoto,alt:"狂犬病ワクチン証明書",width:150,height:100,className:_().vaccineThumbnail})})})]})]}),c.petData.mixedVaccine&&(0,l.jsxs)("div",{className:_().vaccineSection,children:[(0,l.jsx)("h4",{className:_().vaccineTitle,children:"混合ワクチン"}),(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"接種日:"}),(0,l.jsx)("span",{className:_().detailValue,children:c.petData.mixedVaccine.date?d(c.petData.mixedVaccine.date):"不明"})]}),c.petData.mixedVaccine.certPhoto&&(0,l.jsxs)("div",{className:_().detailRow,children:[(0,l.jsx)("span",{className:_().detailLabel,children:"証明書:"}),(0,l.jsx)("div",{className:_().photoContainer,children:(0,l.jsx)("button",{onClick:()=>{var e,a;return u(null!=(a=null==(e=c.petData.mixedVaccine)?void 0:e.certPhoto)?a:null)},className:_().photoButton,"aria-label":"証明書を拡大",children:(0,l.jsx)(s.default,{src:c.petData.mixedVaccine.certPhoto,alt:"混合ワクチン証明書",width:150,height:100,className:_().vaccineThumbnail})})})]})]})]}),(0,l.jsxs)("div",{className:_().modalFooter,children:[(0,l.jsx)("button",{className:_().revertButton,onClick:()=>p(c),children:"承認待ちに戻す"}),(0,l.jsx)("button",{className:_().closeModalButton,onClick:r,children:"閉じる"})]})]}),(0,l.jsx)(m,{photoUrl:h,onClose:()=>u(null)})]}):null};function v(){let[e,a]=(0,n.useState)([]),[t,s]=(0,n.useState)(!0),[i,o]=(0,n.useState)(null),c=(0,n.useCallback)(async()=>{try{s(!0);let e=await fetch("/api/admin/approved"),t=await e.json();if(!t.success)return;a(t.approvedPets)}catch(e){a([])}finally{s(!1)}},[]);(0,n.useEffect)(()=>{c()},[c]);let p=(0,n.useCallback)(async e=>{try{let a=await fetch("/api/admin/revert-to-pending",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.userId,petId:e.petId})}),t=await a.json();t.success?(alert("".concat(e.applicationId," (").concat(e.petName,") を承認待ちに戻しました")),o(null),c()):alert("承認待ちに戻す処理に失敗しました: ".concat(t.message))}catch(e){alert("承認待ちに戻す処理中にエラーが発生しました")}},[c]);return(0,l.jsxs)("div",{className:r().dashboard,children:[(0,l.jsx)(h.B,{}),(0,l.jsxs)("main",{className:r().content,children:[(0,l.jsxs)("div",{className:r().content__header,children:[(0,l.jsx)("h2",{children:"承認済み"}),(0,l.jsx)("button",{onClick:c,className:_().updateButton,children:"データを更新"})]}),(0,l.jsxs)("div",{className:r().content__card,children:[(0,l.jsxs)("h3",{children:["承認済みのペット一覧 (",e.length,"件)"]}),(0,l.jsx)("p",{children:"ペット情報をクリックすると詳細が表示されます。"}),t?(0,l.jsx)("div",{className:_().loadingContainer,children:(0,l.jsx)("p",{children:"データを読み込み中..."})}):0===e.length?(0,l.jsx)("div",{className:_().emptyContainer,children:(0,l.jsx)("p",{children:"承認済みのペットはありません。"})}):(0,l.jsxs)("div",{className:_().petList,children:[(0,l.jsxs)("div",{className:_().petList__header,children:[(0,l.jsx)("div",{className:_().petList__cell,children:"申請ID"}),(0,l.jsx)("div",{className:_().petList__cell,children:"ペット名"}),(0,l.jsx)("div",{className:_().petList__cell,children:"承認日"})]}),e.map(e=>(0,l.jsxs)("button",{className:"".concat(_().petList__row," ").concat(_().listButton),onClick:()=>o(e),"aria-label":"詳細を表示: ".concat(e.petName),children:[(0,l.jsx)("div",{className:_().petList__cell,children:e.applicationId}),(0,l.jsx)("div",{className:_().petList__cell,children:e.petName}),(0,l.jsx)("div",{className:_().petList__cell,children:d(e.approvedAt)})]},"".concat(e.userId,"-").concat(e.petId)))]})]})]}),(0,l.jsx)(u,{pet:i,onClose:()=>o(null),onRevertToPending:p})]})}function x(){let{user:e,loading:a,isAdmin:t}=(0,i.A)();return a?(0,l.jsx)("div",{className:r().authLoading,children:"認証情報を確認中..."}):e&&t?(0,l.jsx)(v,{}):(0,l.jsx)("div",{className:r().authError,children:"管理者権限が必要です"})}},837:e=>{e.exports={dashboard:"app_dashboard__CLE5l",sidebar:"app_sidebar__mEgQl",sidebar__header:"app_sidebar__header__XCGER",sidebar__nav:"app_sidebar__nav__hamVG",active:"app_active__dPqO8",sidebar__footer:"app_sidebar__footer__970jN",content:"app_content__7IxbH",content__header:"app_content__header__KGob0",content__card:"app_content__card__WgF_T",content__card__stats:"app_content__card__stats__84M8b",authLoading:"app_authLoading__rYJvP",authError:"app_authError__E1poB","stat-card":"app_stat-card__zThVn",value:"app_value__A7nx1",icon:"app_icon___3bqa"}},1685:e=>{e.exports={container:"approved_container__Y3Gkz",sidebar:"approved_sidebar__8MS80",sidebar__header:"approved_sidebar__header__8tMqp",sidebar__title:"approved_sidebar__title__9QiWa",sidebar__subtitle:"approved_sidebar__subtitle__mnsB4",sidebar__nav:"approved_sidebar__nav__a5sKo",sidebar__menu:"approved_sidebar__menu__tVFyA",sidebar__menuItem:"approved_sidebar__menuItem__5qriH",sidebar__link:"approved_sidebar__link__3kW_r",sidebar__footer:"approved_sidebar__footer__JK8Gp",sidebar__time:"approved_sidebar__time__MSyB3",active:"approved_active__1XVn3",main:"approved_main__76tqu",main__header:"approved_main__header__Cxk_R",main__title:"approved_main__title__abhJy",main__content:"approved_main__content__cxbkR",petList:"approved_petList__3ebk2",petList__header:"approved_petList__header__uHmZR",petList__row:"approved_petList__row__6Wint",petList__cell:"approved_petList__cell__qQlJM",modalOverlay:"approved_modalOverlay__DUnYO",modalContent:"approved_modalContent__kRDVB",modalHeader:"approved_modalHeader__ZUwVX",modalBody:"approved_modalBody__YX2Z3",modalFooter:"approved_modalFooter__KY_iG",closeButton:"approved_closeButton__b6Hte",revertButton:"approved_revertButton__2lNvh",closeModalButton:"approved_closeModalButton__BEXiz",detailRow:"approved_detailRow__ms7ZF",detailLabel:"approved_detailLabel__99VTf",detailValue:"approved_detailValue__eFDMb",vaccineSection:"approved_vaccineSection__rPqHe",vaccineTitle:"approved_vaccineTitle__znSpH",photoContainer:"approved_photoContainer__qDmSh",vaccineThumbnail:"approved_vaccineThumbnail__7FpG2",photoModalContent:"approved_photoModalContent__ixZYF",photoModalHeader:"approved_photoModalHeader__ZHw2Y",photoModalBody:"approved_photoModalBody__xHrdy",photoButton:"approved_photoButton__Ml0_p",updateButton:"approved_updateButton__nu63h",logoutButton:"approved_logoutButton__JbR20",listButton:"approved_listButton__Ydk2e",loadingContainer:"approved_loadingContainer__MZH46",emptyContainer:"approved_emptyContainer__WQn4T"}},3349:(e,a,t)=>{Promise.resolve().then(t.bind(t,634))},5145:(e,a,t)=>{"use strict";t.d(a,{A:()=>c,default:()=>p});var l=t(5155),s=t(2115),n=t(7016),i=t(7440),d=t(5695);let o=(0,s.createContext)({user:null,loading:!0,isAdmin:!1}),c=()=>(0,s.useContext)(o),r=["3S6PdCwFK2TjGgQMUBnGkp9gTn53","U0rr9czqZGbmR1khmfhUSuPXEtJ2","TpuMV2JJ6eMvT6ZDeVsjqGhjbli1"];function p(e){let{children:a}=e,[t,c]=(0,s.useState)(null),[p,_]=(0,s.useState)(!0),[h,m]=(0,s.useState)(!1),u=(0,d.useRouter)(),v=(0,d.usePathname)();(0,s.useEffect)(()=>{m(!0)},[]),(0,s.useEffect)(()=>{if(!i.j6)return void _(!1);let e=(0,n.hg)(i.j6,e=>{c(e),_(!1),e||"/auth/login"===v?e&&"/auth/login"===v&&(r.includes(e.uid)?u.push("/"):null===i.j6||void 0===i.j6||i.j6.signOut()):u.push("/auth/login")});return()=>e()},[u,v]);let x=!!t&&r.includes(t.uid),j={user:t,loading:p,isAdmin:x};return h?(0,l.jsx)(o.Provider,{value:j,children:a}):(0,l.jsx)(o.Provider,{value:j,children:(0,l.jsx)("div",{className:"app_authLoading__rYJvP",children:"認証情報を確認中..."})})}},5671:(e,a,t)=>{"use strict";t.d(a,{I:()=>n});var l=t(5155);let s={"x-circle":"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm0-9.414l2.828-2.829 1.415 1.415L13.414 12l2.829 2.828-1.415 1.415L12 13.414l-2.828 2.829-1.415-1.415L10.586 12 7.757 9.172l1.415-1.415L12 10.586z","check-circle":"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-.997-6l7.07-7.071-1.414-1.414-5.656 5.657-2.829-2.829-1.414 1.414L11.003 16z",clock:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm1-8h4v2h-6V7h2v5z",bell:"M12 22a2.98 2.98 0 0 0 2.818-2H9.182A2.98 2.98 0 0 0 12 22zm7-7.414V10c0-3.217-2.185-5.927-5.145-6.742C13.562 2.52 12.846 2 12 2s-1.562.52-1.855 1.258C7.185 4.074 5 6.783 5 10v4.586l-1.707 1.707A1 1 0 0 0 3 17v1a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-1a1 1 0 0 0-.293-.707L19 14.586z",dashboard:"M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z",close:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z",logout:"M16 13v-2H7V8l-5 4 5 4v-3z M20 3h-9c-1.103 0-2 .897-2 2v4h2V5h9v14h-9v-4H9v4c0 1.103.897 2 2 2h9c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2z"},n=e=>{let{name:a,size:t=24,className:n=""}=e,i=s[a];return i?(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:t,height:t,className:n,children:(0,l.jsx)("path",{d:i})}):(console.warn('Icon "'.concat(a,'" not found')),null)}},7440:(e,a,t)=>{"use strict";let l,s;t.d(a,{j6:()=>r});var n=t(2479),i=t(7016),d=t(3681),o=t(7398);l=0===(0,n.Dk)().length?(0,n.Wp)({apiKey:"AIzaSyAjmdbaSlO2PJtnThYOI9mrpsoBgq6JWDc",authDomain:"pt-admin-4d877.firebaseapp.com",projectId:"pt-admin-4d877",storageBucket:"pt-admin-4d877.firebasestorage.app",messagingSenderId:"420928013456",appId:"1:420928013456:web:42cde435f10b1949c30415",measurementId:"G-9GWH9VTJP6"}):(0,n.Sx)();let c="appExpo";try{s=(0,n.Sx)(c)}catch(e){s=(0,n.Wp)({apiKey:"AIzaSyBTE5Gpz4rnnVhlDXQA3Va4DNARIhhJhrk",authDomain:"pawticket-6b651.firebaseapp.com",projectId:"pawticket-6b651",storageBucket:"pawticket-6b651.firebasestorage.app",messagingSenderId:"405389818227",appId:"1:405389818227:web:0f77dc15826b1eac13ed06",measurementId:"G-5YNTM317YJ"},c)}let r=(0,i.xI)(l);(0,d.aU)(l),(0,o.c7)(l),(0,d.aU)(s),(0,o.c7)(s)},9592:(e,a,t)=>{"use strict";t.d(a,{B:()=>h});var l=t(5155),s=t(6874),n=t.n(s),i=t(5695),d=t(2115),o=t(7016),c=t(7440),r=t(837),p=t.n(r),_=t(5671);function h(){let e=(0,i.usePathname)(),a=(0,i.useRouter)(),[t,s]=(0,d.useState)("");(0,d.useEffect)(()=>{let e=()=>{s(new Date().toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit",second:"2-digit"}))};e();let a=setInterval(e,1e3);return()=>clearInterval(a)},[]);let r=async()=>{try{c.j6&&await (0,o.CI)(c.j6),await fetch("/api/auth/logout",{method:"POST"}),a.push("/auth/login")}catch(e){console.error("ログアウトエラー:",e)}};return(0,l.jsxs)("aside",{className:p().sidebar,children:[(0,l.jsxs)("div",{className:p().sidebar__header,children:[(0,l.jsx)("h1",{children:"PawTicket Admin"}),(0,l.jsx)("p",{children:"管理パネル"})]}),(0,l.jsx)("nav",{className:p().sidebar__nav,children:(0,l.jsx)("ul",{children:[{name:"ダッシュボード",path:"/",icon:"dashboard"},{name:"承認待ち",path:"/pending",icon:"clock"},{name:"承認済み",path:"/approved",icon:"check-circle"},{name:"却下済み",path:"/rejected",icon:"x-circle"},{name:"プッシュ通知",path:"/notifications",icon:"bell"},{name:"お知らせ一覧",path:"/notifications/list",icon:"bell"},{name:"お知らせ投稿",path:"/notifications/post",icon:"bell"}].map(a=>(0,l.jsx)("li",{children:(0,l.jsxs)(n(),{href:a.path,className:e===a.path?p().active:"",children:[(0,l.jsx)(_.I,{name:a.icon}),a.name]})},a.path))})}),(0,l.jsxs)("div",{className:p().sidebar__footer,children:[(0,l.jsxs)("div",{children:["現在時刻: ",t]}),(0,l.jsxs)("button",{onClick:r,style:{background:"none",border:"none",color:"#666",cursor:"pointer",fontSize:"0.9rem",marginTop:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,l.jsx)(_.I,{name:"logout"}),"ログアウト"]})]})]})}}},e=>{e.O(0,[174,779,566,568,874,766,441,964,358],()=>e(e.s=3349)),_N_E=e.O()}]);